
<!-- List of search results -->
<h2 class="text-center"><%= pluralize @results.count, "result" %> found:</h2>
<div class="line-list-wrapper">
  <div class="col-xs-12 col-md-8" style="padding-left: 0; padding-right: 10px">
    <div class="line-list">
      <ul class="list-unstyled">

        <% @results.each do |line| %>
            <% if line.photo? %>
              <div class="line-li" style="background-image: linear-gradient(135deg, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0.4) 50%), url('<%= cl_image_path line.photo, crop: :fill %>');">
            <% else %>
              <div class="line-li" style="background-image: linear-gradient(135deg, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0.4) 50%), url(<%= image_url('airport-line-3.png') %>);">
            <% end %>
                <li>
                  <h3><%= link_to line.title %></h3>
                  <div class="line-li-data">
                    <table>
                      <tr>
                        <td class="text-center">
                          <i class="fa fa-calendar" aria-hidden="true"></i>
                        </td>
                        <td>
                          <p><%= line.organization_name %></p>
                        </td>
                      </tr>
                      <tr>
                        <td class="text-center">
                          <i class="fa fa-map-marker" aria-hidden="true"></i>
                        </td>
                        <td>
                          <p><%= line.location %></p>
                        </td>
                      </tr>
                    </table>
                  </div>
                </li>
                <li>
                  <% avatar_url = line.user.facebook_picture_url || "avatar-placeholder.png" %>
                  <%= image_tag avatar_url, class: "avatar-large li-avatar" %>
                </li>
                <li>
                  <!-- Circle showing the est time left of the line -->
                  <div class="li-time">
                    <p>About <%= est_time_left(line)%>h left</p>
                  </div>
                </li>
                <a href="<%= line_path(line) %>" class="line-list-link"></a>
              </div>

        <% end %>

      </ul>
    </div>
  </div>

  <!-- Map with geolocation results styled with Snazzymaps -->
  <div class="col-xs-12 col-md-4" style="padding-right: 0; padding-left: 10px">
    <div id="map"></div>

      <% content_for(:after_js) do %>
        <%= javascript_tag do %>
          $(document).ready(function() {
            <!-- Snazzymaps map style -->
            var styles = [ {
                "featureType": "administrative",
                "elementType": "all",
                "stylers": [
                    {
                        "saturation": "-100"
                    }
                ]
            },
            {
                "featureType": "administrative.province",
                "elementType": "all",
                "stylers": [
                    {
                        "visibility": "off"
                    }
                ]
            },
            {
                "featureType": "landscape",
                "elementType": "all",
                "stylers": [
                    {
                        "saturation": -100
                    },
                    {
                        "lightness": 65
                    },
                    {
                        "visibility": "on"
                    }
                ]
            },
            {
                "featureType": "poi",
                "elementType": "all",
                "stylers": [
                    {
                        "saturation": -100
                    },
                    {
                        "lightness": "50"
                    },
                    {
                        "visibility": "simplified"
                    }
                ]
            },
            {
                "featureType": "road",
                "elementType": "all",
                "stylers": [
                    {
                        "saturation": "-100"
                    }
                ]
            },
            {
                "featureType": "road.highway",
                "elementType": "all",
                "stylers": [
                    {
                        "visibility": "simplified"
                    }
                ]
            },
            {
                "featureType": "road.arterial",
                "elementType": "all",
                "stylers": [
                    {
                        "lightness": "30"
                    }
                ]
            },
            {
                "featureType": "road.local",
                "elementType": "all",
                "stylers": [
                    {
                        "lightness": "40"
                    }
                ]
            },
            {
                "featureType": "transit",
                "elementType": "all",
                "stylers": [
                    {
                        "saturation": -100
                    },
                    {
                        "visibility": "simplified"
                    }
                ]
            },
            {
                "featureType": "water",
                "elementType": "geometry",
                "stylers": [
                    {
                        "hue": "#ffff00"
                    },
                    {
                        "lightness": -25
                    },
                    {
                        "saturation": -97
                    }
                ]
            },
            {
                "featureType": "water",
                "elementType": "labels",
                "stylers": [
                    {
                        "lightness": -25
                    },
                    {
                        "saturation": -100
                    }
                ]
            }
        ];
            var handler = Gmaps.build('Google');
            handler.buildMap({ internal: { id: 'map' }, provider:{ styles: styles, scrollwheel: false } }, function() {
              markers = handler.addMarkers(<%= raw @hash.to_json %>);
              handler.bounds.extendWith(markers);
              handler.fitMapToBounds();
              if (markers.length == 0) {
                handler.getMap().setZoom(2);
              } else if (markers.length == 1) {
                handler.getMap().setZoom(14);
              }
            });
          });
        <% end %>
      <% end %>
    </div>
  </div>


</div>
